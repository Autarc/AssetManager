var d=window;function r(a){return Object.prototype.toString.call(a).slice(8,-1)}function u(a){a=a.substr(a.lastIndexOf(".")+1).toLowerCase();if("png"===a||"jpg"===a||"jpeg"===a||"gif"===a||"webp"===a)a="image";else if("wav"===a||"mp3"===a||"ogg"===a||"opus"===a)a="audio";else if("mp4"===a||"avi"===a||"webm"===a)a="movie";else throw Error('[ Undefined Type - ".'+a+'" ]');return a}
function y(a){var b=z[a][0];args=Array.prototype.slice.call(arguments,1);"Array"===r(b)?b[0].apply(b[1],args||[]):console.warn('There is no listener on - "'+a+'":( ')}
function A(a){if(!B.d||!C){var b=new XMLHttpRequest;b.open("GET",a.src,!0);b.onload=function(){var e=b.response;D?E(a,e):H(a,e)};b.onprogress=function(b){b=~~(0.5+B.step*~~(100*(b.loaded/b.total))/100);B.total+=b-B.a[a.src];B.a[a.src]=b;B.b||(100<=B.total&&(B.total=100,B.b=!0),y("progress",{src:a,e:B.total}))};b.onerror=function(e){y("error",{src:a,code:b.error.code,error:e})};b.responseType=D?"blob":"arraybuffer";b.send()}}
function H(a,b){var e=new DataView(b),c=a.type,f=a.src||a.origin,f=f.substr(f.lastIndexOf(".")+1).toLowerCase(),k;try{k=new Blob([e],{type:c+"/"+f})}catch(l){k=(new BlobBuilder).append([e]).getBlob(c+"/"+f)}E(a,k)}
function E(a,b){var e=URL.createObjectURL(b);if("image"===a.type){var c=new Image;c.onload=function(){if(!a.width&&!a.height)I(a,e,c);else{B.length--;var b=a.width||a.height,k=a.height||a.width,l=c.width/b,g=c.height/k,s=0,n,m,t,w,v,F,x=document.createElement("canvas"),G=x.getContext("2d");x.width=b;x.height=k;for(t=0;t<g;t++)for(w=0;w<l;w++){B.length++;G.clearRect(0,0,b,k);G.drawImage(c,w*b,t*k,b,k,0,0,b,k);m=x.toDataURL("img/png");n=atob(m.split(",")[1]);m=new ArrayBuffer(n.length);uint=new Uint8Array(m);
v=0;for(F=n.length;v<F;v++)uint[v]=n.charCodeAt(v);n={type:"image",id:a.id,origin:a.src,frame:s};H(n,m);s++}}};c.src=e}else"audio"===a.type&&a.length||I(a,e)}function I(a,b,e){a.origin?(B.a[a.origin][0]||(B.a[a.origin]=[]),B.a[a.origin][a.frame]=e||b):B.a[a.src]=e||b;a.id?B[a.type][a.id]=B.a[a.src||a.origin]:(B[a.type].c||(B[a.type].c=[]),B[a.type].c.push(B.a[a.src||a.origin]));--B.length||y("load",B)}var D;window.URL||(window.URL=window.webkitURL||window.p||window.q);
window.BlobBuilder||(window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.i||window.h||window.j);D=!0;var C;
if(!window.indexedDB)if(window.mozIndexedDB)window.indexedDB=window.mozIndexedDB;else if(window.webkitIndexedDB)window.indexedDB=window.webkitIndexedDB,IDBCursor=webkitIDBCursor,IDBDatabaseException=webkitIDBDatabaseException,IDBRequest=webkitIDBRequest,IDBKeyRange=webkitIDBKeyRange,IDBTransaction=webkitIDBTransaction;else throw Error("IndexedDB is currently not supported by your browser.");if(!window.indexedDB.deleteDatabase)throw Error("IndexedDB is currently not supported by your browser.");
C=!0;
var z={load:Array(1),error:Array(1),e:Array(1)},B={d:!1,a:{},n:{},m:{},o:{},length:0,total:0,step:0,b:!0},J={k:function(a){var b=[],e=0,c=Object.keys(a),f,k,l,g,s,n,m,t;s=0;for(n=c.length;s<n;s++)if(f=c[s],"Object"===r(a[f])){k=Object.keys(a[f]);m=0;for(t=k.length;m<t;m++)g=a[f][k[m]],l={type:f,id:k[m],src:g.src||g},g.width&&(l.width=g.width),g.height&&(l.height=g.height),"Object"===r(g)&&g.length&&(l.length=g.length),b[e++]=l}else g=a[f],l={type:u(a[f]),id:f,src:g.src||g},g.width&&(l.width=g.width),
g.height&&(l.height=g.height),g.length&&(l.length=g.length),b[e++]=l;return b},f:function(a){var b=[],e=0,c,f,k,l;k=0;for(l=a.length;k<l;k++)c=a[k],"String"!==r(c)?(f={type:c.type||u(c.src),id:c.id,src:c.src},c.width&&(f.width=c.width),c.height&&(f.height=c.height),c.length&&(f.length=c.length)):f={type:u(c),id:null,src:c},b[e++]=f;return b},l:function(a){return[{id:null,type:u(a),src:a}]}};
d.g={r:function(a,b,e){z[a][0]=[b,e]},set:function(a,b,e){if(e){var c=B;console.log("IDB: ",e);c.d=void 0}b&&(z.load[0]=[b]);a=J[r(a)](a);b=a.length;B.length=b;B.b=!1;B.total=0;B.step=~~(0.5+100/b);for(c=0;c<b;c++)e=a[c],B.a[e.src]=0,A(e)},get:function(a,b,e){var c=!b?B.a[a]:B[a][b];if(!c)return null;e&&(c=c[e]);if("String"!==r(c))return c;b||(a=u(a));a="audio"===a?new Audio:document.createElement("video");a.src=c;return a},s:function(a){var a=J[r(a)](a),b=a.length,e,c,f;for(f=0;f<b;f++)e=a[f],c=
B.a[e.src],delete B.a[e.src],URL.revokeObjectURL(c.src||c)}};
